<html>
   <head>
      <meta charset="utf-8"/>
      <script src="wasm_exec.js"></script>
   </head>
   <body>
      <form >
	      <textarea id="koko" name="koko" rows="30" cols="80"></textarea>
      </form>
      <button onclick="makeOutputRun()">Go koko nuts!</button>
      <br/>
      <br/>
      Koko's nutty output:
      <div id="output"></div>

      <script type="text/javascript">
         const queryString = window.location.search;
         const urlParams = new URLSearchParams(queryString);
         const program = urlParams.get('program') || '// Try write some Koko...';
         document.getElementById('koko').innerHTML = program

         const importObj = {
            module: {}
         };
         const go = new Go();
         async function fetchAndInstantiate() {
            const response = await fetch("main.wasm");
            const buffer = await response.arrayBuffer();
            const obj = await WebAssembly.instantiate(buffer, go.importObject);
            console.log(obj);
            go.run(obj.instance);
         }
         fetchAndInstantiate();

         function makeOutputRun() {
            newAddress = encodeURIComponent(document.getElementById('koko').value);
            window.history.pushState("", "konsole", "?program=" + newAddress);
            executeProgram(document.getElementById('koko').value);
            document.getElementById('output').innerHTML = output
         }
      </script>
   </body>
</html>
